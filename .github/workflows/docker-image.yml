name: Docker Image CI

on: [push]

jobs:

  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3
    - name: Intro to job runner
      run: echo "Event:${{ github.event_name }}.\n os:${{ runner.os }} server.\n Repository:${{ github.repository }}:${{ github.ref_name }}.\n"
    - name: List files in the repository
      run: |
        ls ${{ github.workspace }}
#    - name: Build the Docker image
#      run: docker build . --file docker/Dockerfile --tag ghcr.io/${{ github.repository }}:${{ github.ref_name }}
    - name: GHCR Docker Buildx Build
      # You may pin to the exact commit or the version.
      # uses: bskiefer/docker_buildx@9b5f270ae6d0b02e83e32f785d5cd246d85a18eb
      uses: bskiefer/docker_buildx@v1.4
      with:
        tag: # optional, default is latest
          ghcr.io/${{ github.repository }}:${{ github.ref_name }}
        imageName:
          refresher
        dockerFile: # optional, default is Dockerfile
          docker/Dockerfile
    - name: push-to-ghcr
      # You may pin to the exact commit or the version.
      # uses: macbre/push-to-ghcr@d45c4b8f5a72d7fe21f6b832c42d05c29356c840
      uses: macbre/push-to-ghcr@v8
      with:
        github_token: # Your secrets.GITHUB_TOKEN
          secrets.pts
        image_name:
          ${{ github.repository }}
        dockerfile: # optional, default is ./Dockerfile
          docker/Dockerfile

#    - name: Build and push Docker images
#        # You may pin to the exact commit or the version.
#        # uses: docker/build-push-action@e551b19e49efd4e98792db7592c17c09b89db8d8
#        uses: docker/build-push-action@v3.0.0
#        with:
#          file: # optional: Push is a shorthand for --output=type=registry
#            docker/Dockerfile
#          push: # optional, default is false
#            true
#          tags:
#            ghcr.io/${{ github.repository }}:${{ github.ref_name }}
#    #        github-token: # optional, default is ${{ github.token }}
#    #          ${{ secrets.pta }}